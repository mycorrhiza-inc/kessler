FROM python:3.12-bookworm

ENV VIRTUAL_ENV=/usr/local

# Install PostgreSQL 15 with pgvector
RUN apt-get update
RUN apt-get install -y postgresql-common 
RUN echo | /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh
RUN apt-get install -y postgresql-15-pgvector && \
    service postgresql start && \
    sudo -u postgres psql -c "ALTER USER postgres PASSWORD 'password';" && \
    sudo -u postgres psql -c "CREATE DATABASE vector_db;"


# use UV
ADD --chmod=755 https://github.com/astral-sh/uv/releases/latest/download/uv-installer.sh /install.sh
RUN /install.sh && rm /install.sh

# Set up working directory and dependencies
WORKDIR /app
COPY requirements.txt /app/requirements.txt

RUN /root/.cargo/bin/uv pip install --no-cache -r requirements.txt 

# expose to docker network
EXPOSE 5505

# CMD ["uvicorn","main:app", "--host", "0.0.0.0", "5505", "--workers", "4"]
CMD ["python" "rag/postgres_example.py"]

